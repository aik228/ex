#include <windows.h>
#include <math.h>

// Глобальные переменные
int CWIDTH = 300;
int CHEIGHT = 300;
int WHEIGHT = 500;
int WWIDTH = 500;
double minT = 0;
double maxT = 2 * 3.1415;
double dt = 1e-3;
double maxX = 1.5;  // Исправлено: строчная m
double maxY = 1.5;  // Исправлено: строчная m
HPEN pen;

// Структура точки
struct Pnt
{
    double x;
    double y;
};

// Прототипы функций
struct Pnt GetPoint(double t) {
    struct Pnt toRet;
    toRet.x = pow(sin(t), 2);   // x = sin²(t)
    toRet.y = pow(cos(t), 2);   // y = cos²(t)
    return toRet;
};
LRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam);

// Точка входа в программу
int APIENTRY WinMain(HINSTANCE hInstance,
    HINSTANCE hPrevInstance,
    PWSTR pCmdLine,
    int nCmdShow)
{
    // Создаем красное перо
    pen = CreatePen(PS_SOLID, 1, RGB(255, 0, 0));

    MSG msg;
    HWND hwnd;
    WNDCLASS w;

    // Инициализируем структуру класса окна
    memset(&w, 0, sizeof(WNDCLASS));
    w.style = CS_HREDRAW | CS_VREDRAW;
    w.lpfnWndProc = WndProc;
    w.hInstance = hInstance;
    w.hbrBackground = (HBRUSH)GetStockObject(WHITE_BRUSH);  // Исправлено
    w.lpszClassName = L"okno";

    // Регистрируем класс окна
    RegisterClass(&w);

    // Создаем окно
    hwnd = CreateWindow(L"okno", L"okno", WS_OVERLAPPEDWINDOW,
        10, 10, 500, 500, NULL, NULL, hInstance, 0);  // Исправлено: L"okno"

    // Показываем окно
    ShowWindow(hwnd, nCmdShow);
    UpdateWindow(hwnd);

    // Цикл обработки сообщений
    while (GetMessage(&msg, NULL, 0, 0))
    {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    return (int)msg.wParam;
}

// Оконная процедура - обработчик сообщений
LRESULT CALLBACK WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
{
    switch (msg)
    {
    case WM_DESTROY:
        PostQuitMessage(0);
        break;

    case WM_PAINT:
    {
        PAINTSTRUCT ps;
        struct Pnt p;
        double t = minT;
        HDC hdc = BeginPaint(hwnd, &ps);

        // Вычисляем длину стрелочки
        double lenOfArrow;
        if (CWIDTH < CHEIGHT)
            lenOfArrow = CWIDTH * 0.1;
        else
            lenOfArrow = CHEIGHT * 0.1;

        // РИСОВАНИЕ ОСИ X
        // Горизонтальная линия
        MoveToEx(hdc, (WWIDTH - CWIDTH) / 2, WHEIGHT / 2, NULL);
        LineTo(hdc, (WWIDTH + CWIDTH) / 2, WHEIGHT / 2);

        // Стрелочка вправо (верхняя часть)
        LineTo(hdc,
            (int)((WWIDTH + CWIDTH) / 2 - lenOfArrow * sqrt(2.0) / 2.0),
            (int)(WHEIGHT / 2 - lenOfArrow * sqrt(2.0) / 2.0));

        // Стрелочка вправо (нижняя часть)
        MoveToEx(hdc, (WWIDTH + CWIDTH) / 2, WHEIGHT / 2, NULL);
        LineTo(hdc,
            (int)((WWIDTH + CWIDTH) / 2 - lenOfArrow * sqrt(2.0) / 2.0),
            (int)(WHEIGHT / 2 + lenOfArrow * sqrt(2.0) / 2.0));

        // РИСОВАНИЕ ОСИ Y
        // Вертикальная линия
        MoveToEx(hdc, WWIDTH / 2, (WHEIGHT + CHEIGHT) / 2, NULL);
        LineTo(hdc, WWIDTH / 2, (WHEIGHT - CHEIGHT) / 2);

        // Стрелочка вверх (левая часть)
        LineTo(hdc,
            (int)(WWIDTH / 2 - lenOfArrow * sqrt(2.0) / 2.0),
            (int)((WHEIGHT - CHEIGHT) / 2 + lenOfArrow * sqrt(2.0) / 2.0));

        // Стрелочка вверх (правая часть)
        MoveToEx(hdc, WWIDTH / 2, (WHEIGHT - CHEIGHT) / 2, NULL);
        LineTo(hdc,
            (int)(WWIDTH / 2 + lenOfArrow * sqrt(2.0) / 2.0),
            (int)((WHEIGHT - CHEIGHT) / 2 + lenOfArrow * sqrt(2.0) / 2.0));

        // Выбираем красное перо для графика
        SelectObject(hdc, pen);

        // Получаем первую точку графика
        p = GetPoint(t);

        // Преобразуем математические координаты в экранные
        p.x = p.x / maxX * ((double)CWIDTH) / 2.0 + (double)WWIDTH / 2.0;
        p.y = -p.y / maxY * ((double)CHEIGHT) / 2.0 + (double)WHEIGHT / 2.0;

        // Перемещаемся к первой точке
        MoveToEx(hdc, (int)p.x, (int)p.y, NULL);

        // РИСОВАНИЕ ГРАФИКА
        while (t < maxT)
        {
            p = GetPoint(t);

            // Преобразование координат
            p.x = p.x / maxX * (double)CWIDTH / 2.0 + (double)WWIDTH / 2.0;
            p.y = -p.y / maxY * (double)CHEIGHT / 2.0 + (double)WHEIGHT / 2.0;

            // Рисуем линию к следующей точке
            LineTo(hdc, (int)p.x, (int)p.y);

            // Увеличиваем параметр
            t += dt;
        }

        // Завершаем рисование
        EndPaint(hwnd, &ps);
        break;
    }

    case WM_SIZE:
        // Обновляем размеры окна при изменении
        WWIDTH = LOWORD(lParam);
        WHEIGHT = HIWORD(lParam);
        break;

    default:
        // Обработка остальных сообщений по умолчанию
        return DefWindowProc(hwnd, msg, wParam, lParam);
    }

    return 0;
}

// Функция, задающая параметрическую кривую
// МЕНЯЙТЕ ЭТУ ФУНКЦИЮ ДЛЯ РАЗНЫХ ГРАФИКОВ
