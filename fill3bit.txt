.386
.model flat, stdcall
option casemap:none

includelib C:\masm32\lib\kernel32.lib

include C:\masm32\include\kernel32.inc
include C:\masm32\include\windows.inc

.data
stdIn dd ?
stdOut dd ?

cWrite dd 0
cRead dd 0

buf db 100 dup (?)

greetStr db "Enter character: ", 10
badStr db "Bad str", 10
youEnteredStr db "You entered: "
fill3bitStr db "fill3bit: "

.code

; al - input
; al - output
; fills first 3 bits with ones
fill3bit proc
  or al, 11100000b
  ret
fill3bit endp

start:
  invoke GetStdHandle, STD_OUTPUT_HANDLE
  mov stdOut, eax

  invoke GetStdHandle, STD_INPUT_HANDLE
  mov stdIn, eax

  invoke WriteConsoleA, stdOut, addr greetStr, sizeof greetStr, addr cWrite, 0
  invoke ReadConsole,   stdIn,  addr buf, 4, addr cRead, 0

  cmp cRead, 3
  jne badStrCase

  mov [buf + 1], 10
  invoke WriteConsoleA, stdOut, addr youEnteredStr, sizeof youEnteredStr, addr cWrite, 0
  invoke WriteConsoleA, stdOut, addr buf, 2, addr cWrite, 0

  mov al, [buf]
  call fill3bit

  mov [buf], al
  invoke WriteConsoleA, stdOut, addr fill3bitStr, sizeof fill3bitStr, addr cWrite, 0
  invoke WriteConsoleA, stdOut, addr buf, 2, addr cWrite, 0
  jmp endOfProg

badStrCase:
  invoke WriteConsoleA, stdOut, addr badStr, sizeof badStr, addr cWrite, 0

endOfProg:
  invoke ReadConsole, stdIn, addr buf, 1, 0, 0
  invoke ExitProcess, 0

end start
